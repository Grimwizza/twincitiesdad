---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import NewsFeed from '../components/NewsFeed.astro';
import FormattedDate from '../components/FormattedDate.astro';
import { SITE_DESCRIPTION, SITE_TITLE, SOCIAL_LINKS } from '../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const latestPost = posts[0];
const recentPosts = posts.slice(1, 5);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			/* Hero Section */
			.hero {
				min-height: 60vh;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				text-align: center;
				padding: 4rem 1.5rem;
				background: 
					radial-gradient(ellipse at top, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
					var(--bg-primary);
			}
			
			.hero-badge {
				display: inline-block;
				padding: 0.5rem 1rem;
				background: var(--bg-tertiary);
				border-radius: var(--radius-2xl);
				font-size: 0.875rem;
				color: var(--accent-light);
				margin-bottom: 1.5rem;
				border: 1px solid rgba(59, 130, 246, 0.3);
			}
			
			.hero h1 {
				font-size: clamp(2.5rem, 6vw, 4rem);
				margin-bottom: 1rem;
				max-width: 800px;
			}
			
			.hero-subtitle {
				font-size: 1.25rem;
				color: var(--text-secondary);
				max-width: 600px;
				margin: 0 auto 2rem;
				line-height: 1.6;
			}
			
			.hero-cta {
				display: flex;
				gap: 1rem;
				flex-wrap: wrap;
				justify-content: center;
			}
			
			/* Featured Post */
			.featured-section {
				padding: 4rem 1.5rem;
			}
			
			.section-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				max-width: 1200px;
				margin: 0 auto 2rem;
			}
			
			.section-title {
				font-size: 0.875rem;
				text-transform: uppercase;
				letter-spacing: 0.1em;
				color: var(--text-muted);
			}
			
			.view-all {
				color: var(--accent-light);
				font-size: 0.9rem;
			}
			
			.featured-post {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 3rem;
				max-width: 1200px;
				margin: 0 auto;
				align-items: center;
			}
			
			.featured-image {
				position: relative;
				border-radius: var(--radius-xl);
				overflow: hidden;
				aspect-ratio: 16/10;
			}
			
			.featured-image img {
				width: 100%;
				height: 100%;
				object-fit: cover;
				transition: transform var(--transition-slow);
			}
			
			.featured-post:hover .featured-image img {
				transform: scale(1.03);
			}
			
			.featured-content h2 {
				font-size: 2rem;
				margin-bottom: 1rem;
				line-height: 1.2;
			}
			
			.featured-content h2 a {
				color: var(--text-primary);
				text-decoration: none;
				transition: color var(--transition-fast);
			}
			
			.featured-content h2 a:hover {
				color: var(--accent-light);
			}
			
			.featured-meta {
				display: flex;
				align-items: center;
				gap: 1rem;
				margin-bottom: 1rem;
				font-size: 0.9rem;
				color: var(--text-muted);
			}
			
			.featured-excerpt {
				color: var(--text-secondary);
				line-height: 1.7;
				margin-bottom: 1.5rem;
			}
			
			/* Recent Posts Grid */
			.posts-grid {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
				gap: 2rem;
				max-width: 1200px;
				margin: 0 auto;
				padding: 0 1.5rem 4rem;
			}
			
			.post-card {
				background: var(--bg-secondary);
				border-radius: var(--radius-xl);
				overflow: hidden;
				border: 1px solid rgba(255, 255, 255, 0.05);
				transition: all var(--transition-base);
			}
			
			.post-card:hover {
				transform: translateY(-4px);
				box-shadow: var(--shadow-xl);
				border-color: rgba(59, 130, 246, 0.3);
			}
			
			.post-card-image {
				aspect-ratio: 16/9;
				overflow: hidden;
			}
			
			.post-card-image img {
				width: 100%;
				height: 100%;
				object-fit: cover;
				transition: transform var(--transition-slow);
			}
			
			.post-card:hover .post-card-image img {
				transform: scale(1.05);
			}
			
			.post-card-content {
				padding: 1.5rem;
			}
			
			.post-card-date {
				font-size: 0.8rem;
				color: var(--text-muted);
				margin-bottom: 0.5rem;
			}
			
			.post-card-title {
				font-size: 1.25rem;
				margin-bottom: 0.5rem;
				font-family: 'Playfair Display', Georgia, serif;
			}
			
			.post-card-title a {
				color: var(--text-primary);
				text-decoration: none;
			}
			
			.post-card:hover .post-card-title a {
				color: var(--accent-light);
			}
			
			/* Empty state */
			.empty-state {
				text-align: center;
				padding: 4rem 2rem;
				color: var(--text-muted);
			}
			
			@media (max-width: 768px) {
				.featured-post {
					grid-template-columns: 1fr;
					gap: 1.5rem;
				}
				
				.hero {
					min-height: auto;
					padding: 3rem 1rem;
				}
				
				.posts-grid {
					grid-template-columns: 1fr;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<!-- Hero Section -->
			<section class="hero" id="hero-section">
				<span class="hero-badge">üìç Minneapolis-St. Paul</span>
				<h1>Raising Kids in <span class="text-gradient">Minnesota</span></h1>
				<p class="hero-subtitle">
					Documenting life in the Twin Cities from a father's perspective. 
					Politics, community, news, and what it means to raise a family here‚Äîright now.
				</p>
				<div class="hero-cta">
					<a href="/blog" class="btn btn-primary">Read the Blog</a>
					<a href="/about" class="btn btn-secondary">About Me</a>
				</div>
			</section>
			
			<script>
				// Local high-quality Twin Cities images
				const heroImages = [
					'/images/heroes/hero-1.jpg',
					'/images/heroes/hero-2.jpg',
					'/images/heroes/hero-3.jpg',
					'/images/heroes/hero-4.jpg',
					'/images/heroes/hero-5.jpg',
					'/images/heroes/hero-6.jpg'
				];

				function setRandomHeroImage() {
					const heroSection = document.getElementById('hero-section');
					if (!heroSection) return;

					// Select random image
					const randomImage = heroImages[Math.floor(Math.random() * heroImages.length)];
					
					// Create a new image object to preload
					const img = new Image();
					img.onload = () => {
						// Apply background with gradient overlay for text readability
						heroSection.style.background = `
							linear-gradient(rgba(17, 24, 39, 0.7), rgba(17, 24, 39, 0.8)),
							url('${randomImage}') no-repeat center center/cover
						`;
						heroSection.style.transition = 'background 0.5s ease-in-out';
					};
					img.src = randomImage;
				}

				// Run on load
				setRandomHeroImage();
			</script>
			
			<NewsFeed />
			
			{latestPost && (
				<section class="featured-section">
					<div class="section-header">
						<span class="section-title">Latest Post</span>
						<a href="/blog" class="view-all">View all posts ‚Üí</a>
					</div>
					<article class="featured-post">
						{latestPost.data.heroImage && (
							<div class="featured-image">
								<a href={`/blog/${latestPost.id}/`}>
									<Image 
										width={720} 
										height={450} 
										src={latestPost.data.heroImage} 
										alt="" 
									/>
								</a>
							</div>
						)}
						<div class="featured-content">
							<div class="featured-meta">
								<span>üìÖ <FormattedDate date={latestPost.data.pubDate} /></span>
							</div>
							<h2><a href={`/blog/${latestPost.id}/`}>{latestPost.data.title}</a></h2>
							{latestPost.data.description && (
								<p class="featured-excerpt">{latestPost.data.description}</p>
							)}
							<a href={`/blog/${latestPost.id}/`} class="btn btn-primary">Read More</a>
						</div>
					</article>
				</section>
			)}
			
			{recentPosts.length > 0 && (
				<section>
					<div class="section-header" style="padding: 0 1.5rem;">
						<span class="section-title">More Stories</span>
					</div>
					<div class="posts-grid">
						{recentPosts.map((post) => (
							<article class="post-card">
								{post.data.heroImage && (
									<div class="post-card-image">
										<a href={`/blog/${post.id}/`}>
											<Image width={400} height={225} src={post.data.heroImage} alt="" />
										</a>
									</div>
								)}
								<div class="post-card-content">
									<p class="post-card-date">
										<FormattedDate date={post.data.pubDate} />
									</p>
									<h3 class="post-card-title">
										<a href={`/blog/${post.id}/`}>{post.data.title}</a>
									</h3>
								</div>
							</article>
						))}
					</div>
				</section>
			)}
			
			{posts.length === 0 && (
				<div class="empty-state">
					<p>No posts yet. Check back soon!</p>
				</div>
			)}
		</main>
		<Footer />
	</body>
</html>
