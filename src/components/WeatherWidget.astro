---
// Weather Widget - Fetches current Minneapolis weather
// Uses OpenWeatherMap API (client-side fetch)
---

<div class="weather-widget" id="weather-widget">
	<div class="weather-loading">
		<span class="weather-icon">üå°Ô∏è</span>
		<span class="weather-temp">--¬∞F</span>
	</div>
</div>

<style>
	.weather-widget {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.4rem 0.75rem;
		background: var(--bg-tertiary);
		border-radius: var(--radius-md);
		font-size: 0.875rem;
		color: var(--text-primary);
		min-width: 80px;
	}
	
	.weather-loading,
	.weather-content {
		display: flex;
		align-items: center;
		gap: 0.4rem;
	}
	
	.weather-icon {
		font-size: 1.25rem;
	}
	
	.weather-icon img {
		width: 28px;
		height: 28px;
	}
	
	.weather-temp {
		font-weight: 600;
	}
	
	.weather-desc {
		color: var(--text-muted);
		font-size: 0.75rem;
		display: none;
	}
	
	@media (min-width: 640px) {
		.weather-desc {
			display: inline;
		}
	}
</style>

<script>
	// Open-Meteo API (Free, no key required)
	// Minneapolis coordinates
	const LAT = 44.9778;
	const LON = -93.2650;
	
	async function fetchWeather() {
		const widget = document.getElementById('weather-widget');
		
		try {
			const response = await fetch(
				`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true&temperature_unit=fahrenheit`
			);
			const data = await response.json();
			
			if (data.current_weather) {
				const { temperature, weathercode } = data.current_weather;
				const condition = getWeatherCondition(weathercode);
				const emoji = getWeatherEmoji(weathercode);
				
				widget.innerHTML = `
					<div class="weather-content">
						<span class="weather-icon">${emoji}</span>
						<span class="weather-temp">${Math.round(temperature)}¬∞F</span>
						<span class="weather-desc">${condition}</span>
					</div>
				`;
			}
		} catch (error) {
			console.error('Weather fetch failed:', error);
			// Keep loading state or show simple error
			widget.innerHTML = `
				<div class="weather-content">
					<span class="weather-icon">‚ùÑÔ∏è</span>
					<span class="weather-temp">MPLS</span>
				</div>
			`;
		}
	}
	
	// WMO Weather interpretation codes (http://www.wmo.int/pages/prog/www/IMOP/WMO306/WMO306_vI-1/CodeTable_4677.pdf)
	function getWeatherEmoji(code) {
		if (code === 0) return '‚òÄÔ∏è'; // Clear sky
		if (code >= 1 && code <= 3) return '‚õÖ'; // Partly cloudy
		if (code >= 45 && code <= 48) return 'üå´Ô∏è'; // Fog
		if (code >= 51 && code <= 67) return 'üåßÔ∏è'; // Drizzle/Rain
		if (code >= 71 && code <= 77) return '‚ùÑÔ∏è'; // Snow
		if (code >= 80 && code <= 82) return 'üåßÔ∏è'; // Rain showers
		if (code >= 85 && code <= 86) return '‚ùÑÔ∏è'; // Snow showers
		if (code >= 95 && code <= 99) return '‚õàÔ∏è'; // Thunderstorm
		return 'üå°Ô∏è';
	}

	function getWeatherCondition(code) {
		if (code === 0) return 'Clear';
		if (code >= 1 && code <= 3) return 'Partly Cloudy';
		if (code >= 45 && code <= 48) return 'Foggy';
		if (code >= 51 && code <= 67) return 'Raining';
		if (code >= 71 && code <= 77) return 'Snowing';
		if (code >= 80 && code <= 82) return 'Rain Showers';
		if (code >= 85 && code <= 86) return 'Snow Showers';
		if (code >= 95 && code <= 99) return 'Stormy';
		return 'MPLS';
	}
	
	// Fetch on load
	fetchWeather();
	
	// Refresh every 30 minutes
	setInterval(fetchWeather, 30 * 60 * 1000);
</script>
